name: CI
on:
  push:

env:
  TZ: Asia/Shanghai

jobs:
  build:
    name: æ„å»ºä»£ç ï¼Œä»£ç æ£€æŸ¥å’Œæµ‹è¯•ä»£ç 
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ¥Ÿ è®¾ç½® Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      # Setup Node.js environment
      - name: ğŸ“¦ è®¾ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'

      - name: ğŸ“š å®‰è£…ä¾èµ–
        run: bun install --frozen-lockfile

      - name: ğŸ” ä»£ç æ£€æŸ¥
        run: bun run lint

      - name: ğŸ§ª æµ‹è¯•
        run: bun test --coverage

      - name: ğŸ—ï¸ æ„å»ºä»£ç 
        run: |
          bun build \
            --compile \
            --minify-whitespace \
            --minify-syntax \
            --target bun \
            --outfile ./build/server \
            ./src/server.ts

      - name: ğŸ“ æ£€æŸ¥æ„å»ºæ–‡ä»¶å¤§å°
        run: |
          echo "æ„å»ºæ–‡ä»¶å¤§å°ï¼š"
          du -h ./build/server
